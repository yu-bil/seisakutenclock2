<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
<!--
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Content-Security-Policy"
        content="default-src *; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
    <script src="components/loader.js"></script>
    <link rel="stylesheet" href="components/loader.css">
    <link rel="stylesheet" href="css/style.css">
-->
    <script>
            var sw = window.innerWidth; // 表示画面サイズ　640
            var sh = window.innerHeight; //480
            var basewidth = 640, baseheight = 480; // 基本画像（文字盤）サイズ
            // 背景文字盤、時針、分針、秒針
            var array = ["./clock640-480-400-FULL-GOLD.png","./hneedle-skelton.png",
                            "./mneedle-skelton.png","./sneedle-skelton.png" ];
            var img = [];
            for (i=0;i<array.length;i++) {
                img[i] = new Image();
                img[i].src = array[i];
            }
//             // pixi.jsのアプリケーションを作成
//           const app = new PIXI.Application({
//               width: window.innerWidth,
//               height: window.innerHeight,
//               backgroundColor: 0x556b2f, // 背景色
//           });
//         // bodyにpixi.jsのview(ステージ)を追加する
//           document.body.appendChild(app.view);
        
        //ここまで追加
        
            // 画像の幅、画像の高さ、中心のx座標、中心のy座標、画像 "cx":321, "cy":241
            var mojiban = {"width":640, "height":480, "cx":0, "cy":241, "image":img[0]}; 
            var hndl = {"width":241, "height":51, "cx":71, "cy":26, "image":img[1]};
            var mndl = {"width":251, "height":41, "cx":71, "cy":21, "image":img[2]};
            var sndl = {"width":261, "height":31, "cx":71, "cy":16, "image":img[3]};
            var cv;
            var cvgx;
            var factor;
            function init() {
                cv = document.getElementById("clock");
                cv.width = sw;
                cv.height = 3*sh;
                cv.style.backgroundColor = "green"
                cvgx = cv.getContext("2d");
                setInterval(drawClock,30);
            }
            function drawClock() {
                var ratio1 = sw/basewidth, ratio2 = sh/baseheight;
                if (ratio1 < ratio2) {
                    factor = ratio1;
                } else {
                    factor = ratio2;
                }
                var now = new Date();
                var hour = now.getHours();
                var minute = now.getMinutes();
                var second = now.getSeconds();
                var millisecond = now.getMilliseconds();
                 
                var realsecond = second + millisecond/1000;
                var realminute = minute + realsecond/60;
                var realhour = hour%12 + realminute/60;
                 
                var ahour = -Math.PI/2 + Math.PI/6*realhour;
                var aminute = -Math.PI/2 + Math.PI/30*realminute;
                var asecond = -Math.PI/2 + Math.PI/30*realsecond;
//              var asecond = -Math.PI/2 + Math.PI/30*second;
 
                cvgx.clearRect(0,0,sw,sh);
                 
                cvgx.save();
                cvgx.translate(sw/2,sh/2);
                cvgx.drawImage(mojiban.image,-mojiban.cx*factor,-mojiban.cy*factor,
                    mojiban.width*factor,mojiban.height*factor);
                cvgx.restore();
                 
                needleDraw(hndl,ahour);
                needleDraw(mndl,aminute);
                needleDraw(sndl,asecond);
            }
            function needleDraw(needle,angle) {
                cvgx.save();
                cvgx.translate(sw/2,sh/2);
                cvgx.rotate(angle);
                cvgx.drawImage(needle.image,-needle.cx*factor,-needle.cy*factor,
                    needle.width*factor, needle.height*factor);
                cvgx.restore();
            }  
    </script>
</head>
    <body onload="init();">
        <div align="center">
            <canvas id="clock"></canvas>
        </div>
    </body>
</html>
